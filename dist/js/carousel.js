/*! formstone v1.1.0 [carousel.js] 2016-04-03 | MIT License | formstone.it */

!function(a){"function"==typeof define&&define.amd?define(["jquery","./core","./mediaquery","./touch"],a):a(jQuery,Formstone)}(function(a,b){"use strict";function c(){M.iterate.call(N,i)}function d(){N=a(J.base)}function e(c){var e;c.carouselClasses=[K.base,c.theme,c.customClass,c.rtl?K.rtl:K.ltr],c.maxWidth=c.maxWidth===1/0?"100000px":c.maxWidth,c.mq="(min-width:"+c.minWidth+") and (max-width:"+c.maxWidth+")",c.customControls="object"===a.type(c.controls)&&c.controls.previous&&c.controls.next,c.id=this.attr("id"),c.id?c.ariaID=c.id:(c.ariaID=c.rawGuid,this.attr("id",c.ariaID)),b.support.transform||(c.useMargin=!0);var f="",i="",k=[K.control,K.control_previous].join(" "),l=[K.control,K.control_next].join(" ");c.controls&&!c.customControls&&(f+='<div class="'+K.controls+'" aria-label="carousel controls" aria-controls="'+c.ariaID+'">',f+='<button type="button" class="'+k+'" aria-label="'+c.labels.previous+'">'+c.labels.previous+"</button>",f+='<button type="button" class="'+l+'" aria-label="'+c.labels.next+'">'+c.labels.next+"</button>",f+="</div>"),c.pagination&&(i+='<div class="'+K.pagination+'" aria-label="carousel pagination" aria-controls="'+c.ariaID+'" role="navigation">',i+="</div>"),c.autoHeight&&c.carouselClasses.push(K.auto_height),c.contained&&c.carouselClasses.push(K.contained),c.single&&c.carouselClasses.push(K.single),this.addClass(c.carouselClasses.join(" ")).wrapInner('<div class="'+K.wrapper+'" aria-live="polite"><div class="'+K.container+'"><div class="'+K.canister+'"></div></div></div>').append(f).wrapInner('<div class="'+K.viewport+'"></div>').append(i),c.$viewport=this.find(J.viewport).eq(0),c.$container=this.find(J.container).eq(0),c.$canister=this.find(J.canister).eq(0),c.$pagination=this.find(J.pagination).eq(0),c.$paginationItems=c.$pagination.find(J.page),c.$controlPrevious=c.$controlNext=a(""),c.customControls?(c.$controls=a(c.controls.container).addClass([K.controls,K.controls_custom].join(" ")),c.$controlPrevious=a(c.controls.previous).addClass(k),c.$controlNext=a(c.controls.next).addClass(l)):(c.$controls=this.find(J.controls).eq(0),c.$controlPrevious=c.$controls.find(J.control_previous),c.$controlNext=c.$controls.find(J.control_next)),c.$controlItems=c.$controlPrevious.add(c.$controlNext),c.index=0,c.enabled=!1,c.leftPosition=0,c.autoTimer=null,c.resizeTimer=null;var m=this.data(I+"-linked");c.linked=m?"[data-"+I+'-linked="'+m+'"]':!1,c.linked&&(c.paged=!0);var n=this.data(I+"-controller-for")||"";if(c.$subordinate=a(n),"object"===a.type(c.show)){var o=c.show,p=[],q=[];for(e in o)o.hasOwnProperty(e)&&q.push(e);q.sort(M.sortAsc);for(e in q)q.hasOwnProperty(e)&&p.push({width:parseInt(q[e]),count:o[q[e]],mq:window.matchMedia("(min-width: "+parseInt(q[e])+"px)")});c.show=p}j(c),a.fsMediaquery("bind",c.rawGuid,c.mq,{enter:function(){h.call(c.$el,c)},leave:function(){g.call(c.$el,c)}}),d(),c.carouselClasses.push(K.enabled),c.carouselClasses.push(K.animated)}function f(b){M.clearTimer(b.autoTimer),M.clearTimer(b.resizeTimer),g.call(this,b),a.fsMediaquery("unbind",b.rawGuid),b.id!==b.ariaID&&this.attr("id",""),b.$controlItems.removeClass([J.control,K.control_previous,J.control_next,J.visible].join(" ")).off(L.namespace),b.$images.off(L.namespace),b.$canister.fsTouch("destroy"),b.$items.removeClass([K.item,K.visible,J.item_previous,J.item_next].join(" ")).unwrap().unwrap().unwrap().unwrap(),b.pagination&&b.$pagination.remove(),b.controls&&!b.customControls&&b.$controls.remove(),b.customControls&&b.$controls.removeClass([K.controls,K.controls_custom,K.visible].join(" ")),this.removeClass(b.carouselClasses.join(" ")),d()}function g(a){a.enabled&&(M.clearTimer(a.autoTimer),a.enabled=!1,a.$subordinate.off(L.update),this.removeClass([K.enabled,K.animated].join(" ")).off(L.namespace),a.$canister.fsTouch("destroy").off(L.namespace).attr("style","").css(P,"none"),a.$items.css({width:"",height:""}).removeClass([K.visible,J.item_previous,J.item_next].join(" ")),a.$images.off(L.namespace),a.$controlItems.off(L.namespace),a.$pagination.html(""),u(a),a.useMargin?a.$canister.css({marginLeft:""}):a.$canister.css(O,""),a.index=0)}function h(a){a.enabled||(a.enabled=!0,this.addClass(K.enabled).on(L.click,J.page,a,s),a.$controlItems.on(L.click,a,r),a.$items.on(L.click,a,D),a.$subordinate.on(L.update,a,E),a.$canister.fsTouch({axis:"x",pan:!0,swipe:!0}).on(L.panStart,a,y).on(L.pan,a,z).on(L.panEnd,a,A).on(L.swipe,a,B).css(P,""),j(a),a.$images.on(L.load,a,p),a.autoAdvance&&(a.autoTimer=M.startTimer(a.autoTimer,a.autoTime,function(){q(a)},!0)),i.call(this,a))}function i(a){if(a.enabled){var b,c,d,e,f,g,h,i,j,k;if(a.count=a.$items.length,a.count<1)return u(a),void a.$canister.css({height:""});for(this.removeClass(K.animated),a.containerWidth=a.$container.outerWidth(!1),a.visible=x(a),a.perPage=a.paged?1:a.visible,a.itemMarginLeft=parseInt(a.$items.eq(0).css("marginLeft")),a.itemMarginRight=parseInt(a.$items.eq(0).css("marginRight")),a.itemMargin=a.itemMarginLeft+a.itemMarginRight,isNaN(a.itemMargin)&&(a.itemMargin=0),a.itemWidth=(a.containerWidth-a.itemMargin*(a.visible-1))/a.visible,a.itemHeight=0,a.pageWidth=a.paged?a.itemWidth:a.containerWidth,a.pageCount=Math.ceil(a.count/a.perPage),a.canisterWidth=a.single?a.containerWidth:(a.pageWidth+a.itemMargin)*a.pageCount,a.$canister.css({width:a.matchWidth?a.canisterWidth:1e6,height:""}),a.$items.css({width:a.matchWidth?a.itemWidth:"",height:""}).removeClass([K.visible,K.item_previous,K.item_next].join(" ")),a.pages=[],c=0,d=0;c<a.count;c+=a.perPage){for(g=a.$items.slice(c,c+a.perPage),i=0,j=0,g.length<a.perPage&&(g=0===c?a.$items:a.$items.slice(a.$items.length-a.perPage)),h=g.eq(a.rtl?g.length-1:0),k=h.position().left,e=0;e<g.length;e++)f=g.eq(e).outerWidth(!0),b=g.eq(e).outerHeight(),i+=f,b>j&&(j=b);a.pages.push({left:a.rtl?k-(a.canisterWidth-i):k,height:j,width:i,$items:g}),j>a.itemHeight&&(a.itemHeight=j),d++}a.paged&&(a.pageCount-=a.count%a.visible),a.pageCount<=0&&(a.pageCount=1),a.maxMove=-a.pages[a.pageCount-1].left,a.autoHeight?a.$canister.css({height:a.pages[0].height}):a.matchHeight&&a.$items.css({height:a.itemHeight});var l="";for(c=0;c<a.pageCount;c++)l+='<button type="button" class="'+K.page+'">'+(c+1)+"</button>";a.$pagination.html(l),a.pageCount<=1?u(a):v(a),a.$paginationItems=a.$el.find(J.page),t(a,a.index,!1),setTimeout(function(){a.$el.addClass(K.animated)},5)}}function j(a){a.$items=a.$canister.children().not(":hidden").addClass(K.item),a.$images=a.$canister.find("img"),a.totalImages=a.$images.length}function k(a){a.enabled&&l.call(this,a,!1)}function l(a,b){a.$images.off(L.namespace),b!==!1&&a.$canister.html(b),a.index=0,j(a),i.call(this,a)}function m(a,b,c,d){a.enabled&&(M.clearTimer(a.autoTimer),t(a,b-1,!0,c,d))}function n(a){var b=a.index-1;a.infinite&&0>b&&(b=a.pageCount-1),t(a,b)}function o(a){var b=a.index+1;a.infinite&&b>=a.pageCount&&(b=0),t(a,b)}function p(a){var b=a.data;b.resizeTimer=M.startTimer(b.resizeTimer,20,function(){i.call(b.$el,b)})}function q(a){var b=a.index+1;b>=a.pageCount&&(b=0),t(a,b)}function r(b){M.killEvent(b);var c=b.data,d=c.index+(a(b.currentTarget).hasClass(K.control_next)?1:-1);M.clearTimer(c.autoTimer),t(c,d)}function s(b){M.killEvent(b);var c=b.data,d=c.$paginationItems.index(a(b.currentTarget));M.clearTimer(c.autoTimer),t(c,d)}function t(b,c,d,e,f){if(0>c&&(c=b.infinite?b.pageCount-1:0),c>=b.pageCount&&(c=b.infinite?0:b.pageCount-1),!(b.count<1)){b.pages[c]&&(b.leftPosition=-b.pages[c].left),b.leftPosition=F(b,b.leftPosition),b.useMargin?b.$canister.css({marginLeft:b.leftPosition}):d===!1?(b.$canister.css(P,"none").css(O,"translateX("+b.leftPosition+"px)"),setTimeout(function(){b.$canister.css(P,"")},5)):b.$canister.css(O,"translateX("+b.leftPosition+"px)"),b.$items.removeClass([K.visible,K.item_previous,K.item_next].join(" "));for(var g=0,h=b.pages.length;h>g;g++)g===c?b.pages[g].$items.addClass(K.visible).attr("aria-hidden","false"):b.pages[g].$items.not(b.pages[c].$items).addClass(c>g?K.item_previous:K.item_next).attr("aria-hidden","true");b.autoHeight&&b.$canister.css({height:b.pages[c].height}),d!==!1&&e!==!0&&c!==b.index&&(b.infinite||c>-1&&c<b.pageCount)&&b.$el.trigger(L.update,[c]),b.index=c,b.linked&&f!==!0&&a(b.linked).not(b.$el)[H.namespaceClean]("jump",b.index+1,!0,!0),w(b)}}function u(a){a.$controls.removeClass(K.visible),a.$controlItems.removeClass(K.visible),a.$pagination.removeClass(K.visible)}function v(a){a.$controls.addClass(K.visible),a.$controlItems.addClass(K.visible),a.$pagination.addClass(K.visible)}function w(a){a.$paginationItems.removeClass(K.active).eq(a.index).addClass(K.active),a.infinite?a.$controlItems.addClass(K.visible):a.pageCount<1?a.$controlItems.removeClass(K.visible):(a.$controlItems.addClass(K.visible),a.index<=0?a.$controlPrevious.removeClass(K.visible):(a.index>=a.pageCount-1||!a.single&&a.leftPosition===a.maxMove)&&a.$controlNext.removeClass(K.visible))}function x(c){var d=1;if(c.single)return d;if("array"===a.type(c.show))for(var e in c.show)c.show.hasOwnProperty(e)&&(b.support.nativeMatchMedia?c.show[e].mq.matches&&(d=c.show[e].count):c.show[e].width<b.fallbackWidth&&(d=c.show[e].count));else d=c.show;return c.fill&&c.count<d?c.count:d}function y(a){var b=a.data;if(M.clearTimer(b.autoTimer),!b.single){if(b.useMargin)b.leftPosition=parseInt(b.$canister.css("marginLeft"));else{var c=b.$canister.css(O).split(",");b.leftPosition=parseInt(c[4])}b.$canister.css(P,"none"),z(a)}b.isTouching=!0}function z(a){var b=a.data;b.single||(b.touchLeft=F(b,b.leftPosition+a.deltaX),b.useMargin?b.$canister.css({marginLeft:b.touchLeft}):b.$canister.css(O,"translateX("+b.touchLeft+"px)"))}function A(a){var b=a.data,c=Math.abs(a.deltaX),d=G(b,a),e=!1;if(!b.single){var f,g,h=Math.abs(b.touchLeft),i=!1,j=b.rtl?"right":"left";if(a.directionX===j)for(f=0,g=b.pages.length;g>f;f++)i=b.pages[f],h>Math.abs(i.left)+20&&(e=f+1);else for(f=b.pages.length-1,g=0;f>=g;f--)i=b.pages[f],h<Math.abs(i.left)&&(e=f-1)}e===!1&&(e=50>c?b.index:b.index+d),C(b,e)}function B(a){var b=a.data,c=G(b,a),d=b.index+c;C(b,d)}function C(a,b){a.$canister.css(P,""),t(a,b),a.isTouching=!1}function D(b){var c=b.data,d=a(b.currentTarget),e=c.$items.index(d);c.$items.removeClass(K.active),d.addClass(K.active),c.$subordinate[H.namespaceClean]("jump",e+1,!0)}function E(a,b){var c=a.data;c.$items.removeClass(K.active),c.$items.eq(b).addClass(K.active)}function F(a,b){return isNaN(b)?b=0:a.rtl?(b>a.maxMove&&(b=a.maxMove),0>b&&(b=0)):(b<a.maxMove&&(b=a.maxMove),b>0&&(b=0)),b}function G(a,b){return a.rtl?"right"===b.directionX?1:-1:"left"===b.directionX?1:-1}var H=b.Plugin("carousel",{widget:!0,defaults:{autoAdvance:!1,autoHeight:!1,autoTime:8e3,contained:!0,controls:!0,customClass:"",fill:!1,infinite:!1,labels:{next:"Next",previous:"Previous"},matchHeight:!1,matchWidth:!0,maxWidth:1/0,minWidth:"0px",paged:!1,pagination:!0,rtl:!1,show:1,single:!1,theme:"fs-light",useMargin:!1},classes:["ltr","rtl","viewport","wrapper","container","canister","item","item_previous","item_next","controls","controls_custom","control","control_previous","control_next","pagination","page","animated","enabled","visible","active","auto_height","contained","single"],events:{update:"update"},methods:{_construct:e,_destruct:f,_resize:c,disable:g,enable:h,jump:m,previous:n,next:o,reset:k,resize:i,update:l}}),I=H.namespace,J=H.classes,K=J.raw,L=H.events,M=H.functions,N=[],O=b.transform,P=b.transition});