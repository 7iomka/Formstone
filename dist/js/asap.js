/*! Formstone v0.2.0 [asap.js] 2015-02-19 | MIT License | formstone.it */

!function(a,b){"use strict";function c(){o=b.$body}function d(c){z||b.support.history&&(z=a.extend(q,c),z.$container=a(z.container),z.render===a.noop&&(z.render=k),z.transitionOut===a.noop&&(z.transitionOut=function(){return a.Deferred().resolve()}),w=window.location.href,l(),s.on(v.popState,h),e())}function e(){o&&!o.hasClass(r.base)&&o.on(v.click,q.selector,g).addClass(r.base)}function f(a){z&&b.support.history?a&&i(a):window.location.href=a}function g(a){var b=a.currentTarget;if(!(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||window.location.protocol!==b.protocol||window.location.host!==b.host||"_blank"===b.target)){if(b.hash&&(b.href.replace(b.hash,"")===window.location.href.replace(location.hash,"")||b.href===window.location.href+"#"))return void l();u.killEvent(a),a.stopImmediatePropagation(),b.href===w?l():i(b.href)}}function h(a){var b=a.originalEvent.state;b&&(z.modal&&0===x&&b.url&&!b.initial?window.location.href=b.url:b.url!==w&&(z.force?i(b.url):(s.trigger(v.request,[!0]),j(b.url,b.hash,b.data,b.scroll,!1))))}function i(b){y&&y.abort(),s.trigger(v.request,[!1]),z.transitionOutDeferred=z.transitionOut.apply(t,[!1]);var c=b.indexOf("?"),d=b.indexOf("#"),e=c>-1?n(b.slice(c+1)):{},f="",g="User error",h=null,i=a.Deferred();d>-1&&(f=c>-1?b.slice(d,c):b.slice(d)),e[z.requestKey]=!0,y=a.ajax({url:b,data:e,dataType:"json",cache:z.cache,xhr:function(){var a=new t.XMLHttpRequest;return a.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;s.trigger(v.progress,[b])}},!1),a},success:function(c){h="string"==typeof c?a.parseJSON(c):c,c.location&&(b=c.location),i.resolve()},error:function(a,b,c){g=c,i.reject()}}),a.when(i,z.transitionOutDeferred).done(function(){j(b,f,h,z.jump?0:!1,!0)}).fail(function(){s.trigger(v.error,[g])})}function j(b,c,d,e,f){if(s.trigger(v.load),m(b),l(),z.render.call(this,d,c),w=b,f?(history.pushState({url:w,data:d,scroll:e,hash:c},"state-"+w,w),x++):l(),s.trigger(v.render),""!==c){var g=a(c);g.length&&(e=g.offset().top)}e!==!1&&s.scrollTop(e)}function k(b){if("undefined"!=typeof b)for(var c in z.target)z.target.hasOwnProperty(c)&&b.hasOwnProperty(c)&&a(z.target[c]).html(b[c])}function l(){var b=[];for(var c in z.target)z.target.hasOwnProperty(c)&&(b[c]=a(z.target[c]).html());history.replaceState({url:w,data:b,scroll:s.scrollTop()},"state-"+w,w)}function m(a){if(a=a.replace(window.location.protocol+"//"+window.location.host,""),z.tracking.legacy)t._gaq=t._gaq||[],t._gaq.push(["_trackPageview",a]);else if(z.tracking.manager){var b={};b[z.tracking.variable]=a,t.dataLayer=window.dataLayer||[],t.dataLayer.push(b),t.dataLayer.push({event:z.tracking.event})}else"function"==typeof ga&&ga("send","pageview",a)}function n(a){for(var b={},c=a.slice(a.indexOf("?")+1).split("&"),d=0;d<c.length;d++){var e=c[d].split("=");b[e[0]]=e[1]}return b}var o,p=b.Plugin("asap",{utilities:{_setup:c,_initialize:d,load:f},events:{popState:"popstate",request:"request",render:"render"}}),q={cache:!0,force:!1,jump:!0,modal:!1,selector:"a",render:a.noop,requestKey:"fs-asap",target:{title:"title",content:"#fs-asap"},tracking:{legacy:!1,manager:!1,variable:"currentURL",event:"PageView"},transitionOut:a.noop},r={base:p.namespace},s=b.$window,t=s[0],u=p.functions,v=p.events,w="",x=0,y=null,z=null}(jQuery,Formstone);