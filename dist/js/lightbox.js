/*! Formstone v0.0.1 [lightbox.js] 2014-12-24 | MIT License | formstone.it */

!function(a,b,c){"use strict";function d(){O=b.$body}function e(a){this.on(K.click,a,h)}function f(){j(),this.off(K.namespace)}function g(b,c){b instanceof a&&h.apply(M,[{data:a.extend({},{$object:b},H,c||{})}])}function h(c){if(!P){var d=c.data,e=d.$el,f=d.$object,g=e&&e[0].href?e[0].href||"":"",h=e&&e[0].hash?e[0].hash||"":"",k=g.toLowerCase().split(".").pop().split(/\#|\?/),l=k[0],n=e?e.data(G+"-type"):"",o="image"===n||a.inArray(l,d.extensions)>-1||"data:image"===g.substr(0,10),q=g.indexOf("youtube.com/embed")>-1||g.indexOf("player.vimeo.com/video")>-1,r="url"===n||!o&&!q&&"http"===g.substr(0,4)&&!h,t="element"===n||!o&&!q&&!r&&"#"===h.substr(0,1),u="undefined"!=typeof f;if(t&&(g=h),!(o||q||r||t||u))return;if(L.killEvent(c),P=a.extend({},{visible:!1,resizeTimer:null,gallery:{active:!1},isMobile:b.isMobile||d.mobile,isAnimating:!0,oldContentHeight:0,oldContentWidth:0},d),P.margin*=2,P.type=o?"image":q?"video":"element",o||q){var B=e.data(G+"-gallery");B&&(P.gallery.active=!0,P.gallery.id=B,P.gallery.$items=a("a[data-lightbox-gallery= "+P.gallery.id+"], a[rel= "+P.gallery.id+"]"),P.gallery.index=P.gallery.$items.index(P.$el),P.gallery.total=P.gallery.$items.length-1)}var C="";P.isMobile||(C+='<div class="'+[I.raw.overlay,P.customClass].join(" ")+'"></div>');var D=[I.raw.base,I.raw.loading,I.raw.animating,P.customClass];P.fixed&&D.push(I.raw.fixed),P.isMobile&&D.push(I.raw.mobile),r&&D.push(I.raw.iframed),(t||u)&&D.push(I.raw.inline),C+='<div class="'+D.join(" ")+'">',C+='<span class="'+I.raw.close+'">'+P.labels.close+"</span>",C+='<span class="'+I.raw.loading_icon+'"></span>',C+='<div class="'+I.raw.container+'">',C+='<div class="'+I.raw.content+'">',(o||q)&&(C+='<div class="'+I.raw.meta+'">',P.gallery.active&&(C+='<div class="'+[I.raw.control,I.raw.control_previous].join(" ")+'">'+P.labels.previous+"</div>",C+='<div class="'+[I.raw.control,I.raw.control_next].join(" ")+'">'+P.labels.next+"</div>",C+='<p class="'+I.raw.position+'"',P.gallery.total<1&&(C+=' style="display: none;"'),C+=">",C+='<span class="'+I.raw.position_current+'">'+(P.gallery.index+1)+"</span> ",C+=P.labels.count,C+=' <span class="'+I.raw.position_total+'">'+(P.gallery.total+1)+"</span>",C+="</p>"),C+='<div class="'+I.raw.caption+'">',C+=P.formatter.call(e,d),C+="</div></div>"),C+="</div></div></div>",O.append(C),P.$overlay=a(I.overlay),P.$lightbox=a(I.base),P.$close=a(I.close),P.$container=a(I.container),P.$content=a(I.content),P.$meta=a(I.meta),P.$position=a(I.position),P.$caption=a(I.caption),P.$controls=a(I.control),P.paddingVertical=P.isMobile?P.$close.outerHeight()/2:parseInt(P.$lightbox.css("paddingTop"),10)+parseInt(P.$lightbox.css("paddingBottom"),10),P.paddingHorizontal=P.isMobile?0:parseInt(P.$lightbox.css("paddingLeft"),10)+parseInt(P.$lightbox.css("paddingRight"),10),P.contentHeight=P.$lightbox.outerHeight()-P.paddingVertical,P.contentWidth=P.$lightbox.outerWidth()-P.paddingHorizontal,P.controlHeight=P.$controls.outerHeight(),m(),P.gallery.active&&w(),N.on(K.resize,i).on(K.keyDown,x),O.on(K.clickTouchStart,[I.overlay,I.close].join(", "),j),P.gallery.active&&P.$lightbox.on(K.clickTouchStart,I.control,v),P.$lightbox.transition({property:"opacity"},function(){o?p(g):q?s(g):r?z(g):t?y(g):u&&A(P.$object)}).addClass(I.raw.open),P.$overlay.addClass(I.raw.open)}}function i(a){"object"!=typeof a&&(P.targetHeight=arguments[0],P.targetWidth=arguments[1]),"element"===P.type?B(P.$content.find("> :first-child")):"image"===P.type?q():"video"===P.type&&t(),l()}function j(a){L.killEvent(a),P&&(P.$lightbox.transition("destroy"),P.$container.transition("destroy"),P.$lightbox.addClass(I.raw.animating).transition({property:"opacity"},function(){P.$lightbox.off(K.namespace),P.$container.off(K.namespace),N.off(K.namespace),O.off(K.namespace),P.$overlay.remove(),P.$lightbox.remove(),P=null,N.trigger(K.close)}),P.$lightbox.removeClass(I.raw.open),P.$overlay.removeClass(I.raw.open),L.clearTimer(P.resizeTimer))}function k(){{var a=n();P.isMobile?0:P.duration}P.isMobile||P.$controls.css({marginTop:(P.contentHeight-P.controlHeight-P.metaHeight)/2}),!P.visible&&P.isMobile&&P.gallery.active&&P.$content.touch({axis:"x",swipe:!0}).on(K.swipe,D),P.$lightbox.transition({property:"height"},function(){P.$container.transition({property:"opacity"},function(){P.$lightbox.removeClass(I.raw.animating),P.isAnimating=!1}),P.$lightbox.removeClass(I.raw.loading),P.visible=!0,N.trigger(K.open),P.gallery.active&&u()}),P.isMobile||P.$lightbox.css({height:P.contentHeight+P.paddingVertical,width:P.contentWidth+P.paddingHorizontal,top:P.fixed?0:a.top});var b=P.oldContentHeight!==P.contentHeight||P.oldContentWidth!==P.contentWidth;(P.isMobile||!b)&&P.$lightbox.transition("resolve"),P.oldContentHeight=P.contentHeight,P.oldContentWidth=P.contentWidth}function l(){if(P.visible&&!P.isMobile){var a=n();P.$controls.css({marginTop:(P.contentHeight-P.controlHeight-P.metaHeight)/2}),P.$lightbox.css({height:P.contentHeight+P.paddingVertical,width:P.contentWidth+P.paddingHorizontal,top:P.fixed?0:a.top})}}function m(){var a=n();P.$lightbox.css({top:P.fixed?0:a.top})}function n(){if(P.isMobile)return{left:0,top:0};var a={left:(N.width()-P.contentWidth-P.paddingHorizontal)/2,top:P.top<=0?(N.height()-P.contentHeight-P.paddingVertical)/2:P.top};return P.fixed!==!0&&(a.top+=N.scrollTop()),a}function o(){var a=this.attr("title");return a!==c&&""!==a.trim()?'<p class="caption">'+a.trim()+"</p>":""}function p(b){P.$image=a("<img>"),P.$image.one(K.load,function(){var a=E(P.$image);P.naturalHeight=a.naturalHeight,P.naturalWidth=a.naturalWidth,P.retina&&(P.naturalHeight/=2,P.naturalWidth/=2),P.$content.prepend(P.$image),""===P.$caption.html()?P.$caption.hide():P.$caption.show(),q(),k()}).error(C).attr("src",b).addClass(I.raw.image),(P.$image[0].complete||4===P.$image[0].readyState)&&P.$image.trigger(K.load)}function q(){var a=0;for(P.windowHeight=P.viewportHeight=N.height()-P.paddingVertical,P.windowWidth=P.viewportWidth=N.width()-P.paddingHorizontal,P.contentHeight=1/0,P.contentWidth=1/0,P.imageMarginTop=0,P.imageMarginLeft=0;P.contentHeight>P.viewportHeight&&2>a;)P.imageHeight=0===a?P.naturalHeight:P.$image.outerHeight(),P.imageWidth=0===a?P.naturalWidth:P.$image.outerWidth(),P.metaHeight=0===a?0:P.metaHeight,0===a&&(P.ratioHorizontal=P.imageHeight/P.imageWidth,P.ratioVertical=P.imageWidth/P.imageHeight,P.isWide=P.imageWidth>P.imageHeight),P.imageHeight<P.minHeight&&(P.minHeight=P.imageHeight),P.imageWidth<P.minWidth&&(P.minWidth=P.imageWidth),P.isMobile?(P.$meta.css({width:P.windowWidth}),P.metaHeight=P.$meta.outerHeight(!0),P.contentHeight=P.viewportHeight-P.paddingVertical,P.contentWidth=P.viewportWidth-P.paddingHorizontal,r(),P.imageMarginTop=(P.contentHeight-P.targetImageHeight-P.metaHeight)/2,P.imageMarginLeft=(P.contentWidth-P.targetImageWidth)/2):(0===a&&(P.viewportHeight-=P.margin+P.paddingVertical,P.viewportWidth-=P.margin+P.paddingHorizontal),P.viewportHeight-=P.metaHeight,r(),P.contentHeight=P.targetImageHeight,P.contentWidth=P.targetImageWidth),P.$meta.css({width:P.contentWidth}),P.$image.css({height:P.targetImageHeight,width:P.targetImageWidth,marginTop:P.imageMarginTop,marginLeft:P.imageMarginLeft}),P.isMobile||(P.metaHeight=P.$meta.outerHeight(!0),P.contentHeight+=P.metaHeight),a++}function r(){var a=P.isMobile?P.contentHeight-P.metaHeight:P.viewportHeight,b=P.isMobile?P.contentWidth:P.viewportWidth;P.isWide?(P.targetImageWidth=b,P.targetImageHeight=P.targetImageWidth*P.ratioHorizontal,P.targetImageHeight>a&&(P.targetImageHeight=a,P.targetImageWidth=P.targetImageHeight*P.ratioVertical)):(P.targetImageHeight=a,P.targetImageWidth=P.targetImageHeight*P.ratioVertical,P.targetImageWidth>b&&(P.targetImageWidth=b,P.targetImageHeight=P.targetImageWidth*P.ratioHorizontal)),(P.targetImageWidth>P.imageWidth||P.targetImageHeight>P.imageHeight)&&(P.targetImageHeight=P.imageHeight,P.targetImageWidth=P.imageWidth),(P.targetImageWidth<P.minWidth||P.targetImageHeight<P.minHeight)&&(P.targetImageWidth<P.minWidth?(P.targetImageWidth=P.minWidth,P.targetImageHeight=P.targetImageWidth*P.ratioHorizontal):(P.targetImageHeight=P.minHeight,P.targetImageWidth=P.targetImageHeight*P.ratioVertical))}function s(b){P.$videoWrapper=a('<div class="'+I.raw.videoWrapper+'"></div>'),P.$video=a('<iframe class="'+I.raw.video+'" seamless="seamless"></iframe>'),P.$video.attr("src",b).addClass(I.raw.video).prependTo(P.$videoWrapper),P.$content.prepend(P.$videoWrapper),t(),k()}function t(){P.windowHeight=P.viewportHeight=P.contentHeight=N.height()-P.paddingVertical,P.windowWidth=P.viewportWidth=P.contentWidth=N.width()-P.paddingHorizontal,P.videoMarginTop=0,P.videoMarginLeft=0,P.isMobile?(P.$meta.css({width:P.windowWidth}),P.metaHeight=P.$meta.outerHeight(!0),P.viewportHeight-=P.metaHeight,P.targetVideoWidth=P.viewportWidth,P.targetVideoHeight=P.targetVideoWidth*P.videoRatio,P.targetVideoHeight>P.viewportHeight&&(P.targetVideoHeight=P.viewportHeight,P.targetVideoWidth=P.targetVideoHeight/P.videoRatio),P.videoMarginTop=(P.viewportHeight-P.targetVideoHeight)/2,P.videoMarginLeft=(P.viewportWidth-P.targetVideoWidth)/2):(P.viewportHeight=P.windowHeight-P.margin,P.viewportWidth=P.windowWidth-P.margin,P.targetVideoWidth=P.videoWidth>P.viewportWidth?P.viewportWidth:P.videoWidth,P.targetVideoWidth<P.minWidth&&(P.targetVideoWidth=P.minWidth),P.targetVideoHeight=P.targetVideoWidth*P.videoRatio,P.contentHeight=P.targetVideoHeight,P.contentWidth=P.targetVideoWidth),P.$meta.css({width:P.contentWidth}),P.$videoWrapper.css({height:P.targetVideoHeight,width:P.targetVideoWidth,marginTop:P.videoMarginTop,marginLeft:P.videoMarginLeft}),P.isMobile||(P.metaHeight=P.$meta.outerHeight(!0),P.contentHeight=P.targetVideoHeight+P.metaHeight)}function u(){var b="";P.gallery.index>0&&(b=P.gallery.$items.eq(P.gallery.index-1).attr("href"),b.indexOf("youtube.com/embed")<0&&b.indexOf("player.vimeo.com/video")<0&&a('<img src="'+b+'">')),P.gallery.index<P.gallery.total&&(b=P.gallery.$items.eq(P.gallery.index+1).attr("href"),b.indexOf("youtube.com/embed")<0&&b.indexOf("player.vimeo.com/video")<0&&a('<img src="'+b+'">'))}function v(b){L.killEvent(b);var c=a(b.currentTarget);P.isAnimating||c.hasClass(I.raw.control_disabled)||(P.isAnimating=!0,P.gallery.index+=c.hasClass(I.raw.control_next)?1:-1,P.gallery.index>P.gallery.total&&(P.gallery.index=P.gallery.total),P.gallery.index<0&&(P.gallery.index=0),P.$lightbox.addClass([I.raw.loading,I.raw.animating].join(" ")),P.$container.transition({property:"opacity"},function(){"undefined"!=typeof P.$image&&P.$image.remove(),"undefined"!=typeof P.$videoWrapper&&P.$videoWrapper.remove(),P.$el=P.gallery.$items.eq(P.gallery.index),P.$caption.html(P.formatter.call(P.$el,P)),P.$position.find(I.position_current).html(P.gallery.index+1);var a=P.$el.attr("href"),b=a.indexOf("youtube.com/embed")>-1||a.indexOf("player.vimeo.com/video")>-1;b?s(a):p(a),w()}))}function w(){P.$controls.removeClass(I.raw.control_disabled),0===P.gallery.index&&P.$controls.filter(I.control_previous).addClass(J.control_disabled),P.gallery.index===P.gallery.total&&P.$controls.filter(I.control_next).addClass(J.control_disabled)}function x(a){!P.gallery.active||37!==a.keyCode&&39!==a.keyCode?27===a.keyCode&&P.$close.trigger(K.click):(L.killEvent(a),P.$controls.filter(37===a.keyCode?I.control_previous:I.control_next).trigger(K.click))}function y(b){var c=a(b).find("> :first-child").clone();A(c)}function z(b){b+=b.indexOf("?")>-1?"&"+P.requestKey+"=true":"?"+P.requestKey+"=true";var c=a('<iframe class="'+I.raw.iframe+'" src="'+b+'"></iframe>');A(c)}function A(a){P.$content.append(a),B(a),k()}function B(a){P.windowHeight=N.height()-P.paddingVertical,P.windowWidth=N.width()-P.paddingHorizontal,P.objectHeight=a.outerHeight(!0),P.objectWidth=a.outerWidth(!0),P.targetHeight=P.targetHeight||(P.$el?P.$el.data(G+"-height"):null),P.targetWidth=P.targetWidth||(P.$el?P.$el.data(G+"-width"):null),P.maxHeight=P.windowHeight<0?P.minHeight:P.windowHeight,P.isIframe=a.is("iframe"),P.objectMarginTop=0,P.objectMarginLeft=0,P.isMobile||(P.windowHeight-=P.margin,P.windowWidth-=P.margin),P.contentHeight=P.targetHeight?P.targetHeight:P.isIframe||P.isMobile?P.windowHeight:P.objectHeight,P.contentWidth=P.targetWidth?P.targetWidth:P.isIframe||P.isMobile?P.windowWidth:P.objectWidth,(P.isIframe||P.isObject)&&P.isMobile?(P.contentHeight=P.windowHeight,P.contentWidth=P.windowWidth):P.isObject&&(P.contentHeight=P.contentHeight>P.windowHeight?P.windowHeight:P.contentHeight,P.contentWidth=P.contentWidth>P.windowWidth?P.windowWidth:P.contentWidth)}function C(){var b=a('<div class="'+I.raw.error+'"><p>Error Loading Resource</p></div>');P.type="element",P.$meta.remove(),P.$image.off(K.namespace),A(b)}function D(a){P.$controls.filter("left"===a.directionX?I.control_next:I.control_previous).trigger(K.click)}function E(a){var b=a[0],c=new Image;return"undefined"!=typeof b.naturalHeight?{naturalHeight:b.naturalHeight,naturalWidth:b.naturalWidth}:"img"===b.tagName.toLowerCase()?(c.src=b.src,{naturalHeight:c.height,naturalWidth:c.width}):!1}var F=b.Plugin("lightbox",{widget:!0,defaults:{customClass:"",extensions:["jpg","sjpg","jpeg","png","gif"],fixed:!1,formatter:o,labels:{close:"Close",count:"of",next:"Next",previous:"Previous"},margin:50,minHeight:100,minWidth:100,mobile:!1,retina:!1,requestKey:"boxer",top:0,videoRatio:.5625,videoWidth:600},classes:["loading","animating","fixed","mobile","inline","iframed","open","overlay","close","loading_icon","container","content","image","video","video_wrapper","meta","control","control_previous","control_next","control_disabled","position","position_current","position_total","caption","iframe","error"],events:{open:"open",close:"close",swipe:"swipe"},methods:{_setup:d,_construct:e,_destruct:f,resize:i},utilities:{_initialize:g,close:j}}),G=F.namespace,H=F.defaults,I=F.classes,J=I.raw,K=F.events,L=F.functions,M=b.window,N=b.$window,O=null,P=null}(jQuery,Formstone);