/*! formstone v1.1.1 [crop.js] 2016-05-17 | GPL-3.0 License | formstone.it */

!function(a){"function"==typeof define&&define.amd?define(["jquery","./core","./touch"],a):a(jQuery,Formstone)}(function(a,b){"use strict";function c(a){a.baseClasses=[p.base,a.theme,a.customClass].join(" "),a.touching=!1,a.ready=!1;var b="";b+='<div class="'+p.container+'"></div>',b+='<div class="'+p.container_copy+'"></div>',a.$el.addClass(a.baseClasses).append(b),a.$container=a.$el.find(o.container),a.$containerCopy=a.$el.find(o.container_copy),a.$el.css({width:a.width,height:a.height}),a.$container.touch({pan:!0,scale:!0}),a.source&&e(a,a.source)}function d(a){this.removeClass(a.baseClasses).html("")}function e(b,c){b.$image=a('<img class="'+p.image+'">'),b.$imageCopy=a('<img class="'+p.image_copy+'">'),b.$image.on(q.load,b,f).on(q.error,b,g).attr("src",c).appendTo(b.$container),b.$imageCopy.attr("src",c).appendTo(b.$containerCopy)}function f(a){var b=a.data;b.ready=!0;var c=m(b.$image);b.naturalHeight=c.naturalHeight,b.naturalWidth=c.naturalWidth,b.naturalWidth>b.naturalHeight?(b.ratio=b.naturalWidth/b.naturalHeight,b.minHeight=b.height,b.minWidth=b.height*b.ratio):(b.ratio=b.naturalHeight/b.naturalWidth,b.minWidth=b.width,b.minHeight=b.width*b.ratio),b.targetWidth=b.minWidth,b.targetHeight=b.minHeight,b.targetLeft=(b.targetWidth-b.minWidth)/2,b.targetTop=(b.targetHeight-b.minHeight)/2,l(b),k(b),b.$container.on(q.scaleStart,b,h).on(q.scaleEnd,b,j).on(q.scale,b,i),console.log("loaded")}function g(a){a.data;console.log("Load Error")}function h(a){var b=a.data;b.ready&&(b.touching=!0,b.startWidth=b.targetWidth,b.startHeight=b.targetHeight,b.startLeft=b.targetLeft,b.startTop=b.targetTop,b.currentZoom=b.targetHeight/b.naturalHeight)}function i(a){var b=a.data;if(b.ready&&b.touching){var c=b.startWidth*a.scale,d=b.startHeight*a.scale,e=(b.startWidth-c)/2,f=(b.startHeight-d)/2,g=b.startLeft+a.deltaX+e,h=b.startTop+a.deltaY+f;c<b.minWidth&&(c=b.minWidth),c>b.naturalWidth&&(c=b.naturalWidth),d<b.minHeight&&(d=b.minHeight),d>b.naturalHeight&&(d=b.naturalHeight),b.targetHeight=d,b.targetWidth=c,l(b);var i=d/b.startHeight;g<b.minLeft&&(g=b.minLeft),g>b.maxLeft&&(g=b.maxLeft),h<b.minTop&&(h=b.minTop),h>b.maxTop&&(h=b.maxTop),b.targetTop=h,b.targetLeft=g,b.currentZoom=i,b.zoom=d/b.naturalHeight,b.scale=b.naturalHeight/b.height,console.log(b.scale),k(b)}}function j(b){var c=b.data;if(c.ready){console.log(c.targetTop,c.currentZoom);var d=a.Event("position",{bubbles:!0,height:c.height*c.scale,width:c.width*c.scale,top:c.targetTop/c.zoom,left:c.targetLeft/c.zoom});c.$el.trigger(d)}}function k(a){a.ready&&(a.$image.css({left:a.targetLeft,top:a.targetTop,width:a.targetWidth,height:a.targetHeight}),a.$imageCopy.css({left:a.targetLeft,top:a.targetTop,width:a.targetWidth,height:a.targetHeight}))}function l(a){a.maxLeft=0,a.maxTop=0,a.minLeft=a.width-a.targetWidth,a.minTop=a.height-a.targetHeight}function m(a){var b=a[0],c=new Image;return"undefined"!=typeof b.naturalHeight?{naturalHeight:b.naturalHeight,naturalWidth:b.naturalWidth}:"img"===b.tagName.toLowerCase()?(c.src=b.src,{naturalHeight:c.height,naturalWidth:c.width}):!1}var n=b.Plugin("crop",{widget:!0,defaults:{customClass:"",height:600,width:600,theme:"fs-light"},classes:["container","container_copy","image","image_copy","loaded"],events:["scalestart","scale","scaleend"],methods:{_construct:c,_destruct:d}}),o=n.classes,p=o.raw,q=n.events;n.functions,b.window,b.$window});