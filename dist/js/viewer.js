/*! formstone v1.2.2 [viewer.js] 2016-08-20 | GPL-3.0 License | formstone.it */

!function(a){"function"==typeof define&&define.amd?define(["jquery","./core","./transition"],a):a(jQuery,Formstone)}(function(a,b){"use strict";function c(){}function d(){}function e(){A=a(w.base)}function f(c){var d,f="";c=a.extend({},c,{images:[],source:!1,gallery:!1,isMobile:b.isMobile,isTouch:b.support.touch,isAnimating:!0,isZooming:!1,tapTimer:null}),c.doTouch=c.isMobile&&c.isTouch,c.margin=0,c.margin*=2,c.thisClasses=[x.base,x.animating,x.loading,c.customClass,c.theme],c.$images=this.find("img").addClass(x.source),c.index=0,c.total=c.$images.length-1,c.$images.length>1&&(c.gallery=!0);for(var g=0;g<c.$images.length;g++)d=c.$images.eq(g),c.images.push(d.attr("src"));f+='<div class="'+x.wrapper+'">',f+='<div class="'+x.viewport+'"></div>',f+='<div class="'+x.controls+'">',f+='<button type="button" class="'+[x.control,x.zoom_out].join(" ")+'">'+c.labels.zoom_out+"</button>",f+='<button type="button" class="'+[x.control,x.zoom_in].join(" ")+'">'+c.labels.zoom_in+"</button>",c.gallery&&(f+='<button type="button" class="'+[x.control,x.control_previous].join(" ")+'">'+c.labels.previous+"</button>",f+='<button type="button" class="'+[x.control,x.control_next].join(" ")+'">'+c.labels.next+"</button>"),f+="</div>",f+="</div>",this.addClass(c.thisClasses.join(" ")).prepend(f),c.$wrapper=this.find(w.wrapper),c.$viewport=this.find(w.viewport),c.$controlBox=this.find(w.controls),c.$controls=this.find(w.control),e(),l(c),console.log(c.images),c.$controls.on(y.click,[w.control_previous,w.control_next].join(", "),c,k),h(c,c.images[c.index]),console.log(c)}function g(a){}function h(b,c,d){b.$container=a('<div class="'+x.container+'"><img></div>'),b.$image=b.$container.find("img"),b.$image.one(y.load,function(){j(b),b.$container.fsTransition({property:"opacity"},function(){console.log("loaded!")}),b.doTouch&&b.$viewport.fsTouch({pan:!0,scale:!0}).on(y.scaleStart,b,p).on(y.scaleEnd,b,r).on(y.scale,b,q),d&&b.$el.trigger(y.loaded)}).attr("src",c).addClass(x.image),b.$viewport.append(b.$container),(b.$image[0].complete||4===b.$image[0].readyState)&&b.$image.trigger(y.load),b.source=c}function i(a){}function j(a){a.naturalSize=u(a.$image);var b=a.viewportHeight,c=a.viewportWidth,d=a.naturalSize;a.imageHeight=d.naturalHeight,a.imageWidth=d.naturalWidth,a.ratioHorizontal=a.imageHeight/a.imageWidth,a.ratioVertical=a.imageWidth/a.imageHeight,a.isWide=a.imageWidth>a.imageHeight,a.isWide?(a.targetImageWidth=c,a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal,a.targetImageHeight>b&&(a.targetImageHeight=b,a.targetImageWidth=a.targetImageHeight*a.ratioVertical)):(a.targetImageHeight=b,a.targetImageWidth=a.targetImageHeight*a.ratioVertical,a.targetImageWidth>c&&(a.targetImageWidth=c,a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal)),(a.targetImageWidth>a.imageWidth||a.targetImageHeight>a.imageHeight)&&(a.targetImageHeight=a.imageHeight,a.targetImageWidth=a.imageWidth),(a.targetImageWidth<a.minWidth||a.targetImageHeight<a.minHeight)&&(a.targetImageWidth<a.minWidth?(a.targetImageWidth=a.minWidth,a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal):(a.targetImageHeight=a.minHeight,a.targetImageWidth=a.targetImageHeight*a.ratioVertical)),a.$container.css({top:a.viewportHeight/2,left:a.viewportWidth/2}),a.$image.css({height:a.targetImageHeight,width:a.targetImageWidth,top:-(a.targetImageHeight/2),left:-(a.targetImageWidth/2)}),a.doTouch&&(a.scaleMinHeight=a.targetImageHeight,a.scaleMinWidth=a.targetImageWidth,a.scaleMaxHeight=a.imageHeight,a.scaleMaxWidth=a.imageWidth)}function k(){}function l(a){console.log(a),a.viewportHeight=a.$viewport.outerHeight(),a.viewportWidth=a.$viewport.outerWidth(),a.source&&j(a)}function m(a){}function n(a){if(a.$image&&a.$image.length){a.isZooming=!0,a.$el.addClass(x.zooming).removeClass(x.scaling);var b=a.targetImageHeight>a.scaleMinHeight+1?"out":"in";console.log(b),"out"===b?(a.targetImageHeight=a.scaleMinHeight,a.targetImageWidth=a.scaleMinWidth):(a.targetImageHeight=a.scaleMaxHeight,a.targetImageWidth=a.scaleMaxWidth);var c=a.$viewport.outerHeight(),d=a.$viewport.outerWidth();a.scalePosition.top=a.targetContainerY=c/2,a.scalePosition.left=a.targetContainerX=d/2,a.$container.css({left:a.targetContainerX,top:a.targetContainerY}),a.$image.fsTransition({property:"top"},function(){a.isZooming=!1,a.$el.removeClass(x.zooming)}).css({height:a.targetImageHeight,width:a.targetImageWidth,top:-(a.targetImageHeight/2),left:-(a.targetImageWidth/2)}),console.log(a)}}function o(a){a.scalePosition=a.$container.position(),a.scaleY=a.scalePosition.top,a.scaleX=a.scalePosition.left,a.scaleHeight=a.$image.outerHeight(),a.scaleWidth=a.$image.outerWidth()}function p(a){var b=a.data;b.isZooming||(b.$el.removeClass(x.zooming).addClass(x.scaling),o(b),s(b),console.log(b.targetImageHeight,b.targetImageWidth))}function q(a){var b=a.data;if(!b.isZooming){t(b);b.targetImageHeight>b.scaleMinHeight+1;b.targetContainerY=b.scaleY+a.deltaY,b.targetContainerX=b.scaleX+a.deltaX,b.targetContainerY=b.scaleY,b.targetContainerX=b.scaleX,b.targetContainerY+=a.deltaY,b.targetContainerX+=a.deltaX,b.targetImageHeight=b.scaleHeight*a.scale,b.targetImageWidth=b.scaleWidth*a.scale,b.targetImageHeight<b.scaleMinHeight&&(b.targetImageHeight=b.scaleMinHeight),b.targetImageHeight>b.scaleMaxHeight&&(b.targetImageHeight=b.scaleMaxHeight),b.targetImageWidth<b.scaleMinWidth&&(b.targetImageWidth=b.scaleMinWidth),b.targetImageWidth>b.scaleMaxWidth&&(b.targetImageWidth=b.scaleMaxWidth),b.hasScaled=!0,b.$container.css({top:b.targetContainerY,left:b.targetContainerX});var c={height:b.targetImageHeight,width:b.targetImageWidth,left:-(b.targetImageWidth/2)};c.top=-(b.targetImageHeight/2),b.$image.css(c)}}function r(a){var b=a.data;if(!b.isZooming){o(b);var c=b.$viewport.outerHeight(),d=b.$viewport.outerWidth();b.scaleMinY=c-b.scaleHeight/2,b.scaleMinX=d-b.scaleWidth/2,b.scaleMaxY=b.scaleHeight/2,b.scaleMaxX=b.scaleWidth/2,b.scaleHeight<c?b.scalePosition.top=c/2:(b.scalePosition.top<b.scaleMinY&&(b.scalePosition.top=b.scaleMinY),b.scalePosition.top>b.scaleMaxY&&(b.scalePosition.top=b.scaleMaxY)),b.scaleWidth<d?b.scalePosition.left=d/2:(b.scalePosition.left<b.scaleMinX&&(b.scalePosition.left=b.scaleMinX),b.scalePosition.left>b.scaleMaxX&&(b.scalePosition.left=b.scaleMaxX)),b.$el.removeClass(x.scaling),b.$container.css({left:b.scalePosition.left,top:b.scalePosition.top})}}function s(a){null===a.tapTimer?a.tapTimer=z.startTimer(a.tapTimer,500,function(){t(a)}):(t(a),n(a))}function t(a){z.clearTimer(a.tapTimer),a.tapTimer=null}function u(a){var b=a[0],c=new Image;return"undefined"!=typeof b.naturalHeight?{naturalHeight:b.naturalHeight,naturalWidth:b.naturalWidth}:"img"===b.tagName.toLowerCase()&&(c.src=b.src,{naturalHeight:c.height,naturalWidth:c.width})}var v=b.Plugin("viewer",{widget:!0,defaults:{customClass:"",labels:{count:"of",next:"Next",previous:"Previous",zoom_in:"Zoom In",zoom_out:"Zoom Out"},theme:"fs-light"},classes:["source","wrapper","viewport","container","image","controls","control_previous","control_next","zoom_in","zoom_out","animating","loading","scaling","zooming"],events:{loaded:"loaded",ready:"ready"},methods:{_setup:c,_construct:f,_destruct:g,_resize:d,resize:m,load:h,unload:i}}),w=v.classes,x=w.raw,y=v.events,z=v.functions,A=(b.window,b.$window,[])});