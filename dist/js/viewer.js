/*! formstone v1.2.2 [viewer.js] 2016-08-27 | GPL-3.0 License | formstone.it */

!function(a){"function"==typeof define&&define.amd?define(["jquery","./core","./transition"],a):a(jQuery,Formstone)}(function(a,b){"use strict";function c(){e(),V.on("scroll",e)}function d(){U.iterate.call(X,L),U.iterate.call(Y,N),U.iterate.call(Y,O)}function e(){W=V.scrollTop()+b.windowHeight,W<0&&(W=0),U.iterate.call(Y,O)}function f(){U.iterate.call(X,H)}function g(){X=a(R.base),Y=a(R.lazy),U.iterate.call(Y,N)}function h(a){var b,c="";console.log(a),a.thisClasses=[S.base,S.loading,a.customClass,a.theme],a.images=[],a.source=!1,a.gallery=!1,a.tapTimer=null,a.action=!1,a.loaded=!1,a.render=!1,a.zooming=!1,a.keyDownTime=1,a.$images=this.find("img").addClass(S.source),a.index=0,a.total=a.$images.length-1,a.$images.length>1&&(a.gallery=!0,a.thisClasses.push(S.gallery));for(var d=0;d<a.$images.length;d++)b=a.$images.eq(d),a.images.push(b.attr("src"));c+='<div class="'+S.wrapper+'">',c+='<div class="'+S.loading_icon+'"></div>',c+='<div class="'+S.viewport+'"></div>',c+="</div>",c+='<div class="'+S.controls+'">',c+='<button type="button" class="'+[S.control,S.control_previous].join(" ")+'">'+a.labels.previous+"</button>",c+='<button type="button" class="'+[S.control,S.zoom_out].join(" ")+'">'+a.labels.zoom_out+"</button>",c+='<button type="button" class="'+[S.control,S.zoom_in].join(" ")+'">'+a.labels.zoom_in+"</button>",c+='<button type="button" class="'+[S.control,S.control_next].join(" ")+'">'+a.labels.next+"</button>",c+="</div>",this.addClass(a.thisClasses.join(" ")).prepend(c),a.$wrapper=this.find(R.wrapper),a.$viewport=this.find(R.viewport),a.$controlBox=this.find(R.controls),a.$controls=this.find(R.control),g(),a.$controlBox.on(T.click,[R.control_previous,R.control_next].join(", "),a,K).on([T.touchStart,T.mouseDown].join(" "),R.zoom_out,a,F).on([T.touchStart,T.mouseDown].join(" "),R.zoom_in,a,E).on([T.touchEnd,T.mouseUp].join(" "),[R.zoom_out,R.zoom_in].join(", "),a,G),a.lazy?O(a):l(a,a.images[a.index],!0)}function i(a){a.$wrapper.remove(),a.$image.removeClass(S.source),this.removeClass(a.thisClasses.join(" ")).off(T.namespace),g()}function j(a,b){a.index=0,"string"==typeof b?(a.total=0,a.images=[b],a.gallery=!1,a.$el.removeClass(S.gallery)):(a.total=b.length-1,a.images=b,b.length>1&&(a.gallery=!0,a.$el.addClass(S.gallery)),b=a.images[a.index]),J(a,function(){l(a,b)})}function k(a){l(a,a.images[a.index])}function l(b,c,d){b.$container=a('<div class="'+S.container+'"><img></div>'),b.$image=b.$container.find("img"),b.$viewport.append(b.$container),b.$image.one(T.load,function(){m(b),b.loaded=!0,b.$container.fsTransition({property:"opacity"},function(){}),b.$el.removeClass(S.loading),b.$container.fsTouch({pan:!0,scale:!0}).on(T.scaleStart,b,A).on(T.scaleEnd,b,C).on(T.scale,b,B),b.$el.trigger(T.loaded)}).attr("src",c).addClass(S.image),(b.$image[0].complete||4===b.$image[0].readyState)&&b.$image.trigger(T.load),b.source=c}function m(a){n(a),o(a),a.containerTop=a.viewportHeight/2,a.containerLeft=a.viewportWidth/2,q(a),a.imageHeight=a.naturalHeight,a.imageWidth=a.naturalWidth,u(a),p(a),r(a),s(a),t(a);var b={containerTop:a.containerTop,containerLeft:a.containerLeft,imageHeight:a.imageHeight,imageWidth:a.imageWidth,imageTop:a.imageTop,imageLeft:a.imageLeft};z(a,b),a.render=!0}function n(a){var b=P(a.$image);a.naturalHeight=b.naturalHeight,a.naturalWidth=b.naturalWidth,a.ratioHorizontal=a.naturalHeight/a.naturalWidth,a.ratioVertical=a.naturalWidth/a.naturalHeight,a.isWide=a.naturalWidth>a.naturalHeight}function o(a){a.viewportHeight=a.$viewport.outerHeight(),a.viewportWidth=a.$viewport.outerWidth()}function p(a){a.imageHeight<=a.viewportHeight?(a.containerMinTop=a.viewportHeight/2,a.containerMaxTop=a.viewportHeight/2):(a.containerMinTop=a.viewportHeight-a.imageHeight/2,a.containerMaxTop=a.imageHeight/2),a.imageWidth<=a.viewportWidth?(a.containerMinLeft=a.viewportWidth/2,a.containerMaxLeft=a.viewportWidth/2):(a.containerMinLeft=a.viewportWidth-a.imageWidth/2,a.containerMaxLeft=a.imageWidth/2)}function q(a){a.isWide?(a.imageMinWidth=a.viewportWidth,a.imageMinHeight=a.imageMinWidth*a.ratioHorizontal,a.imageMinHeight>a.viewportHeight&&(a.imageMinHeight=a.viewportHeight,a.imageMinWidth=a.imageMinHeight*a.ratioVertical)):(a.imageMinHeight=a.viewportHeight,a.imageMinWidth=a.imageMinHeight*a.ratioVertical,a.imageMinWidth>a.viewportWidth&&(a.imageMinWidth=a.viewportWidth,a.imageMinHeight=a.imageMinWidth*a.ratioHorizontal)),(a.imageMinWidth>a.naturalWidth||a.imageMinHeight>a.naturalHeight)&&(a.imageMinHeight=a.naturalHeight,a.imageMinWidth=a.naturalWidth),a.imageMaxHeight=a.naturalHeight,a.imageMaxWidth=a.naturalWidth}function r(a){a.imageTop=-(a.imageHeight/2),a.imageLeft=-(a.imageWidth/2)}function s(a){a.lastContainerTop=a.containerTop,a.lastContainerLeft=a.containerLeft,a.lastImageHeight=a.imageHeight,a.lastImageWidth=a.imageWidth,a.lastImageTop=a.imageTop,a.lastImageLeft=a.imageLeft}function t(a){a.renderContainerTop=a.lastContainerTop,a.renderContainerLeft=a.lastContainerLeft,a.renderImageTop=a.lastImageTop,a.renderImageLeft=a.lastImageLeft,a.renderImageHeight=a.lastImageHeight,a.renderImageWidth=a.lastImageWidth}function u(a){a.imageHeight=a.imageMinHeight,a.imageWidth=a.imageMinWidth}function v(a){a.imageHeight<a.imageMinHeight&&(a.imageHeight=a.imageMinHeight),a.imageHeight>a.imageMaxHeight&&(a.imageHeight=a.imageMaxHeight),a.imageWidth<a.imageMinWidth&&(a.imageWidth=a.imageMinWidth),a.imageWidth>a.imageMaxWidth&&(a.imageWidth=a.imageMaxWidth)}function w(a){a.containerTop<a.containerMinTop&&(a.containerTop=a.containerMinTop),a.containerTop>a.containerMaxTop&&(a.containerTop=a.containerMaxTop),a.containerLeft<a.containerMinLeft&&(a.containerLeft=a.containerMinLeft),a.containerLeft>a.containerMaxLeft&&(a.containerLeft=a.containerMaxLeft)}function x(a){null===a.tapTimer?a.tapTimer=U.startTimer(a.tapTimer,500,function(){y(a)}):(y(a),D(a))}function y(a){U.clearTimer(a.tapTimer),a.tapTimer=null}function z(a,c){if(b.transform){var d=c.imageWidth/a.naturalWidth,e=c.imageHeight/a.naturalHeight;a.$container.css(b.transform,"translate3d("+c.containerLeft+"px, "+c.containerTop+"px, 0)"),a.$image.css(b.transform,"translate3d(-50%, -50%, 0) scale("+d+","+e+")")}else a.$container.css({top:c.containerTop,left:c.containerLeft}),a.$image.css({height:c.imageHeight,width:c.imageWidth,top:c.imageTop,left:c.imageLeft})}function A(a){var b=a.data;x(b),s(b)}function B(a){var b=a.data;y(b),b.render=!1,b.zooming=!1;b.imageHeight>b.imageMinHeight+1;b.containerTop=b.lastContainerTop+a.deltaY,b.containerLeft=b.lastContainerLeft+a.deltaX,b.imageHeight=b.lastImageHeight*a.scale,b.imageWidth=b.lastImageWidth*a.scale,p(b),w(b),v(b),r(b);var c={containerTop:b.containerTop,containerLeft:b.containerLeft,imageHeight:b.imageHeight,imageWidth:b.imageWidth,imageTop:b.imageTop,imageLeft:b.imageLeft};z(b,c)}function C(a){var b=a.data;b.zooming||(s(b),t(b),b.render=!0)}function D(a){var b=a.imageHeight>a.imageMinHeight+1;a.zooming=!0,s(a),t(a),b?(a.imageHeight=a.imageMinHeight,a.imageWidth=a.imageMinWidth):(a.imageHeight=a.imageMaxHeight,a.imageWidth=a.imageMaxWidth),p(a),w(a),r(a),a.render=!0}function E(a){U.killEvent(a);var b=a.data;b.keyDownTime=1,b.action="zoom_in"}function F(a){U.killEvent(a);var b=a.data;b.keyDownTime=1,b.action="zoom_out"}function G(a){var b=a.data;b.action=!1}function H(a){if(a.render){if(a.action){a.keyDownTime+=a.zoomIncrement;var b=("zoom_out"===a.action?-1:1)*Math.round(a.imageWidth*a.keyDownTime-a.imageWidth);b>a.zoomDelta&&(b=a.zoomDelta),a.isWide?(a.imageWidth+=b,a.imageHeight=Math.round(a.imageWidth/a.ratioVertical)):(a.imageHeight+=b,a.imageWidth=Math.round(a.imageHeight/a.ratioHorizontal)),v(a),r(a),p(a),w(a)}a.renderContainerTop+=Math.round((a.containerTop-a.renderContainerTop)*a.zoomEnertia),a.renderContainerLeft+=Math.round((a.containerLeft-a.renderContainerLeft)*a.zoomEnertia),a.renderImageTop+=Math.round((a.imageTop-a.renderImageTop)*a.zoomEnertia),a.renderImageLeft+=Math.round((a.imageLeft-a.renderImageLeft)*a.zoomEnertia),a.renderImageHeight+=Math.round((a.imageHeight-a.renderImageHeight)*a.zoomEnertia),a.renderImageWidth+=Math.round((a.imageWidth-a.renderImageWidth)*a.zoomEnertia);var c={containerTop:a.renderContainerTop,containerLeft:a.renderContainerLeft,imageHeight:a.renderImageHeight,imageWidth:a.renderImageWidth,imageTop:a.renderImageTop,imageLeft:a.renderImageLeft};z(a,c)}}function I(a){J(a)}function J(a,b){y(a),a.render=!1,a.zooming=!1,M(a),a.$container.fsTransition({property:"opacity"},function(){a.$container.remove(),"function"==typeof b&&b.call(window,a)}),a.$el.addClass(S.loading)}function K(b){var c=a(b.currentTarget),d=b.data,e=d.index+(c.hasClass(S.control_next)?1:-1);e<0&&(e=0),e>d.total&&(e=d.total),e!==d.index&&(d.index=e,J(d,function(){l(d,d.images[d.index])}))}function L(a){o(a),p(a),q(a),r(a),p(a),w(a),v(a)}function M(a){a.$container&&a.$container.length&&a.$container.fsTouch("destroy").off(T.scaleStart,A).off(T.scaleEnd,C).off(T.scale,B)}function N(a){a.scrollTop=a.$el.offset().top}function O(a){!a.visible&&a.scrollTop<W+a.lazyEdge&&(a.visible=!0,k(a))}function P(a){var b=a[0],c=new Image;return"undefined"!=typeof b.naturalHeight?{naturalHeight:b.naturalHeight,naturalWidth:b.naturalWidth}:"img"===b.tagName.toLowerCase()&&(c.src=b.src,{naturalHeight:c.height,naturalWidth:c.width})}var Q=b.Plugin("viewer",{widget:!0,defaults:{customClass:"",lazy:!1,lazyEdge:100,labels:{count:"of",next:"Next",previous:"Previous",zoom_in:"Zoom In",zoom_out:"Zoom Out"},theme:"fs-light",zoomDelta:100,zoomEnertia:.2,zoomIncrement:.01},classes:["source","wrapper","viewport","container","image","gallery","loading_icon","controls","control","control_previous","control_next","zoom_in","zoom_out","loading"],events:{loaded:"loaded",ready:"ready"},methods:{_setup:c,_construct:h,_destruct:i,_resize:d,_raf:f,resize:L,load:j,unload:I}}),R=Q.classes,S=R.raw,T=Q.events,U=Q.functions,V=(b.window,b.$window),W=0,X=[],Y=[]});