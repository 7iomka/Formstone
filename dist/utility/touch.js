/*! 
 * Formstone v0.0.1 - 2014-11-19 
 * Library of modular javascript components. 
 * http://formstone.it/ 
 * 
 * Copyright 2014 Ben Plum; MIT Licensed 
 */

!function(a,b){"use strict";function c(a){a.touches=[],a.tap?(a.pan=!1,a.scale=!1,this.on(l.touchStart,a,f).on(l.click,a,i)):(a.pan||a.scale)&&(a.tap=!1,this.on([l.touchStart].join(" "),a,e),a.pan&&this.on(l.mouseDown,a,f))}function d(){this.off(l.namespace)}function e(a){a.preventManipulation&&a.preventManipulation(),a.preventDefault(),a.stopPropagation();var b=a.data,c=a.originalEvent;if(c.type.match(/(up|end)$/i))return void h(a);if(c.pointerId){var d=!1;for(var e in b.touches)b.touches[e].identifier===c.pointerId&&(d=!0,b.touches[e].pageX=c.clientX,b.touches[e].pageY=c.clientY);d||b.touches.push({identifier:c.pointerId,pageX:c.clientX,pageY:c.clientY})}else b.touches=c.touches;c.type.match(/(down|start)$/i)?f(a):c.type.match(/move$/i)&&g(a)}function f(a){a.stopPropagation();var b=a.data,c="undefined"!=typeof a.originalEvent.touches?a.originalEvent.touches[0]:null;if(b.startE=a.originalEvent,b.startX=c?c.pageX:a.pageX,b.startY=c?c.pageY:a.pageY,b.tap)b.clicked=!1,b.$el.on(l.touchMove,b,g).on([l.touchEnd,l.touchCancel].join(" "),b,h);else if(b.pan||b.scale){m.killEvent(a);var d=j(b.scale?l.scaleStart:l.panStart,a,b.startX,b.startY,1);b.scale&&b.touches&&b.touches.length>=2&&(b.pinchStartX0=b.touches[0].pageX,b.pinchStartY0=b.touches[0].pageY,b.pinchStartX1=b.touches[1].pageX,b.pinchStartY1=b.touches[1].pageY,b.pinchStartX=(b.pinchStartX0+b.pinchStartX1)/2,b.pinchStartY=(b.pinchStartY0+b.pinchStartY1)/2,b.pinchDeltaStart=Math.sqrt(Math.pow(b.pinchStartX1-b.pinchStartX0,2)+Math.pow(b.pinchStartY1-b.pinchStartY0,2)),d.pageX=b.pinchStartX,d.pageY=b.pinchStartY),b.pan&&n.on(l.mouseMove,b,g).on(l.mouseUp,b,h),n.on([l.touchMove,l.touchEnd,l.touchCancel].join(" "),b,e),b.$el.trigger(d)}}function g(a){var b=a.data,c="undefined"!=typeof a.originalEvent.touches?a.originalEvent.touches[0]:null,d=c?c.pageX:a.pageX,e=c?c.pageY:a.pageY;if(b.tap&&(Math.abs(d-b.startX)>10||Math.abs(e-b.startY)>10))b.$el.off([l.touchMove,l.touchEnd,l.touchCancel].join(" "));else if(b.pan||b.scale){var f=!0,g=j(b.scale?l.scale:l.pan,a,d,e,1);b.scale&&(b.touches&&b.touches.length>=2?(b.pinchEndX0=b.touches[0].pageX,b.pinchEndY0=b.touches[0].pageY,b.pinchEndX1=b.touches[1].pageX,b.pinchEndY1=b.touches[1].pageY,b.pinchDeltaEnd=Math.sqrt(Math.pow(b.pinchEndX1-b.pinchEndX0,2)+Math.pow(b.pinchEndY1-b.pinchEndY0,2)),b.scale=b.pinchDeltaEnd/b.pinchDeltaStart,b.pinchEndX=(b.pinchEndX0+b.pinchEndX1)/2,b.pinchEndY=(b.pinchEndY0+b.pinchEndY1)/2,g.pageX=b.pinchEndX,g.pageY=b.pinchEndY,g.scale=b.scale):b.pan||(f=!1)),f&&b.$el.trigger(g)}}function h(a){var b=a.data;if(b.tap)b.$el.off([l.touchMove,l.touchEnd,l.touchCancel,l.mouseMove,l.mouseUp].join(" ")),b.startE.preventDefault(),i(a);else if(b.pan||b.scale){var c="undefined"!=typeof a.originalEvent.touches?a.originalEvent.touches[0]:null,d=c?c.pageX:a.pageX,e=c?c.pageY:a.pageY,f=j(b.scale?l.scaleEnd:l.panEnd,a,d,e,1);if(b.scale)if(a.originalEvent.pointerId)for(var g in b.touches)b.touches[g].id===a.originalEvent.pointerId&&b.touches.splice(g,1);else b.touches=a.originalEvent.touches;n.off([l.touchMove,l.touchEnd,l.touchCancel,l.mouseMove,l.mouseUp].join(" ")),b.$el.trigger(f)}}function i(a){m.killEvent(a);var b=a.data;if(!b.clicked){"click"!==a.type&&(b.clicked=!0);var c=b.startE?b.startX:a.pageX,d=b.startE?b.startY:a.pageY,e=j(l.tap,b.oe,c,d,1);b.$el.trigger(e)}}function j(b,c,d,e,f){return a.Event(b,{pageX:d,pageY:e,scale:f,originalEvent:c})}var k=b.Plugin("touch",{widget:!0,classes:!1,defaults:{pan:!1,swipe:!1,scale:!1,tap:!1},methods:{_construct:c,_destruct:d}}),l=k.events,m=k.functions,n=b.$window;l.tap="tap",l.pan="pan",l.panStart="panstart",l.panEnd="panend",l.scale="scale",l.scaleStart="scalestart",l.scaleEnd="scaleend"}(jQuery,Formstone);