!function(a,b){"use strict";function c(b,c){b.length&&("string"===a.type(c)&&"destroy"===c?o.iterate.apply(a(b),[e].concat(Array.prototype.slice.call(arguments,1))):o.iterate.apply(a(b),[d].concat(Array.prototype.slice.call(arguments,1))))}function d(b,c){var d=this;o.getData(d)||(b=a.extend(!0,b,{$element:d,$el:d,touches:[]},c),b.tap?(b.pan=!1,b.scale=!1,d.on(n.touchStart,b,g).on(n.click,b,j)):(b.pan||b.scale)&&(b.tap=!1,d.on([n.touchStart].join(" "),b,f),b.pan&&d.on(n.mouseDown,b,g)),d.data(m,b))}function e(){this.off(n.namespace).removeData(m)}function f(a){a.preventManipulation&&a.preventManipulation(),a.preventDefault(),a.stopPropagation();var b=a.data,c=a.originalEvent;if(c.type.match(/(up|end)$/i))return void i(a);if(c.pointerId){var d=!1;for(var e in b.touches)b.touches[e].identifier===c.pointerId&&(d=!0,b.touches[e].pageX=c.clientX,b.touches[e].pageY=c.clientY);d||b.touches.push({identifier:c.pointerId,pageX:c.clientX,pageY:c.clientY})}else b.touches=c.touches;c.type.match(/(down|start)$/i)?g(a):c.type.match(/move$/i)&&h(a)}function g(b){b.stopPropagation();var c=b.data,d="undefined"!==a.type(b.originalEvent.touches)?b.originalEvent.touches[0]:null;if(c.startE=b.originalEvent,c.startX=d?d.pageX:b.pageX,c.startY=d?d.pageY:b.pageY,c.tap)c.clicked=!1,c.$el.on(n.touchMove,c,h).on([n.touchEnd,n.touchCancel].join(" "),c,i);else if(c.pan||c.scale){o.killEvent(b);var e=k(c.scale?n.scaleStart:n.panStart,b,c.startX,c.startY,1,0,0);c.scale&&c.touches&&c.touches.length>=2&&(c.pinchStartX0=c.touches[0].pageX,c.pinchStartY0=c.touches[0].pageY,c.pinchStartX1=c.touches[1].pageX,c.pinchStartY1=c.touches[1].pageY,c.pinchStartX=(c.pinchStartX0+c.pinchStartX1)/2,c.pinchStartY=(c.pinchStartY0+c.pinchStartY1)/2,c.pinchDeltaStart=Math.sqrt(Math.pow(c.pinchStartX1-c.pinchStartX0,2)+Math.pow(c.pinchStartY1-c.pinchStartY0,2)),e.pageX=c.startX=c.pinchStartX,e.pageY=c.startY=c.pinchStartY),c.pan&&p.on(n.mouseMove,c,h).on(n.mouseUp,c,i),p.on([n.touchMove,n.touchEnd,n.touchCancel].join(" "),c,f),c.$el.trigger(e)}}function h(b){var c=b.data,d="undefined"!==a.type(b.originalEvent.touches)?b.originalEvent.touches[0]:null,e=d?d.pageX:b.pageX,f=d?d.pageY:b.pageY,g=e-c.startX,h=f-c.startY;if(c.tap&&(Math.abs(e-c.startX)>10||Math.abs(f-c.startY)>10))c.$el.off([n.touchMove,n.touchEnd,n.touchCancel].join(" "));else if(c.pan||c.scale){var i=!0,j=k(c.scale?n.scale:n.pan,b,e,f,1,g,h);c.scale&&(c.touches&&c.touches.length>=2?(c.pinchEndX0=c.touches[0].pageX,c.pinchEndY0=c.touches[0].pageY,c.pinchEndX1=c.touches[1].pageX,c.pinchEndY1=c.touches[1].pageY,c.pinchDeltaEnd=Math.sqrt(Math.pow(c.pinchEndX1-c.pinchEndX0,2)+Math.pow(c.pinchEndY1-c.pinchEndY0,2)),c.scale=c.pinchDeltaEnd/c.pinchDeltaStart,c.pinchEndX=(c.pinchEndX0+c.pinchEndX1)/2,c.pinchEndY=(c.pinchEndY0+c.pinchEndY1)/2,j.pageX=c.pinchEndX,j.pageY=c.pinchEndY,j.scale=c.scale,j.deltaX=c.pinchEndX-c.pinchStartX,j.deltaY=c.pinchEndY-c.pinchStartY):c.pan||(i=!1)),i&&c.$el.trigger(j)}}function i(b){var c=b.data;if(c.tap)c.$el.off([n.touchMove,n.touchEnd,n.touchCancel,n.mouseMove,n.mouseUp].join(" ")),c.startE.preventDefault(),j(b);else if(c.pan||c.scale){var d="undefined"!==a.type(b.originalEvent.touches)?b.originalEvent.touches[0]:null,e=d?d.pageX:b.pageX,f=d?d.pageY:b.pageY,g=e-c.startX,h=f-c.startY,i=k(c.scale?n.scaleEnd:n.panEnd,b,e,f,1,g,h);if(c.scale)if(b.originalEvent.pointerId)for(var l in c.touches)c.touches[l].id===b.originalEvent.pointerId&&c.touches.splice(l,1);else c.touches=b.originalEvent.touches;p.off([n.touchMove,n.touchEnd,n.touchCancel,n.mouseMove,n.mouseUp].join(" ")),c.$el.trigger(i)}}function j(a){o.killEvent(a);var b=a.data;if(!b.clicked){"click"!==a.type&&(b.clicked=!0);var c=b.startE?b.startX:a.pageX,d=b.startE?b.startY:a.pageY,e=k(n.tap,b.oe,c,d,1);b.$el.trigger(e)}}function k(b,c,d,e,f,g,h){return a.Event(b,{pageX:d,pageY:e,scale:f,deltaX:g,deltaY:h,originalEvent:c,preventDefault:c.preventDefault})}var l=b.Plugin("touch",{defaults:{pan:!1,swipe:!1,scale:!1,tap:!1},methods:{_delegate:c}}),m=l.namespace,n=l.events,o=l.functions,p=b.$window;n.tap="tap",n.pan="pan",n.panStart="panstart",n.panEnd="panend",n.scale="scale",n.scaleStart="scalestart",n.scaleEnd="scaleend"}(jQuery,Formstone);