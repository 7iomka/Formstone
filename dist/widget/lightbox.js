/*! 
 * Formstone v0.0.1 - 2014-11-26 
 * Library of modular javascript components. 
 * http://formstone.it/ 
 * 
 * Copyright 2014 Ben Plum; MIT Licensed 
 */

!function(a){"use strict";function b(a){a.formatter=l,this.on(G.click,a,d)}function c(){g(),this.off(G.namespace)}function d(b){if(!K){var c=b.data,d=c.$el,e=c.$object,h=d[0].href?d[0].href||"":"",i=d[0].hash?d[0].hash||"":"",k=h.toLowerCase().split(".").pop().split(/\#|\?/),l=k[0],n=d.data(F.namespace+"-type")||"",o="image"===n||a.inArray(l,c.extensions)>-1||"data:image"===h.substr(0,10),q=h.indexOf("youtube.com/embed")>-1||h.indexOf("player.vimeo.com/video")>-1,r="url"===n||!o&&!q&&"http"===h.substr(0,4)&&!i,y="element"===n||!o&&!q&&!r&&"#"===i.substr(0,1),z="undefined"!=typeof e;if(y&&(h=i),!(o||q||r||y||z))return;if(H.killEvent(b),K=a.extend({},{visible:!1,resizeTimer:null,touchTimer:null,gallery:{active:!1},isMobile:Formstone.isMobile||c.mobile,isAnimating:!0,oldContentHeight:0,oldContentWidth:0},c),K.margin*=2,K.type=o?"image":q?"video":"element",o||q){var A=d.data("gallery");A&&(K.gallery.active=!0,K.gallery.id=A,K.gallery.$items=a("a[data-gallery= "+K.gallery.id+"], a[rel= "+K.gallery.id+"]"),K.gallery.index=K.gallery.$items.index(c.$target),K.gallery.total=K.gallery.$items.length-1)}var B="";K.isMobile||(B+='<div class="'+[F.overlay,K.customClass].join(" ")+'"></div>'),B+='<div class="'+[F.base,F.loading,F.animating,K.customClass].join(" "),c.fixed&&(B+=F.fixed),c.isMobile&&(B+=F.obile),r&&(B+=F.frame),(y||z)&&(B+=F.sInline),B+='">',B+='<span class="'+F.close+'">'+K.labels.close+"</span>",B+='<span class="'+F.loading_icon+'"></span>',B+='<div class="'+F.container+'">',B+='<div class="'+F.content+'">',(o||q)&&(B+='<div class="'+F.meta+'">',K.gallery.active?(B+='<div class="'+[F.control,F.control_previous].join(" ")+'">'+K.labels.previous+"</div>",B+='<div class="'+[F.control,F.control_next].join(" ")+'">'+K.labels.next+"</div>",B+='<p class="'+F.position+'"',K.gallery.total<1&&(B+=' style="display: none;"'),B+=">",B+='<span class="'+F.position_current+'">'+(K.gallery.index+1)+"</span> ",B+=K.labels.count,B+=' <span class="'+F.position_total+'">'+(K.gallery.total+1)+"</span>",B+="</p>",B+='<div class="'+[F.caption,F.caption_gallery].join(" ")+'">'):B+='<div class="'+F.caption+'">',B+=K.formatter.call(d,c),B+="</div></div>"),B+="</div></div></div>",J.append(B),K.$overlay=a(H.getClassName(F.overlay)),K.$lightbox=a(H.getClassName(F.base)),K.$close=a(H.getClassName(F.close)),K.$container=a(H.getClassName(F.container)),K.$content=a(H.getClassName(F.content)),K.$meta=a(H.getClassName(F.meta)),K.$position=a(H.getClassName(F.position)),K.$caption=a(H.getClassName(F.caption)),K.$controls=a(H.getClassName(F.control)),K.paddingVertical=K.isMobile?K.$close.outerHeight()/2:parseInt(K.$lightbox.css("paddingTop"),10)+parseInt(K.$lightbox.css("paddingBottom"),10),K.paddingHorizontal=K.isMobile?0:parseInt(K.$lightbox.css("paddingLeft"),10)+parseInt(K.$lightbox.css("paddingRight"),10),K.contentHeight=K.$lightbox.outerHeight()-K.paddingVertical,K.contentWidth=K.$lightbox.outerWidth()-K.paddingHorizontal,K.controlHeight=K.$controls.outerHeight(),j(),K.gallery.active&&t(),I.on(G.resize,f).on(G.keyDown,u),J.on(G.clickTouchStart,[H.getClassName(F.overlay),H.getClassName(F.close)].join(", "),g).on(G.touchMove,H.killEvent),K.gallery.active&&K.$lightbox.on(G.clickTouchStart,H.getClassName(F.control),s),K.$lightbox.transition({always:!1,complete:function(){o?m(h):q?p(h):r?w(h):y?v(h):z&&x(K.$object)}}),J.addClass(F.open)}}function e(){K.$lightbox.off(G.namespace),K.$overlay.trigger(G.click)}function f(a){"object"!=typeof a&&(K.targetHeight=arguments[0],K.targetWidth=arguments[1]),"element"===K.type?y(K.$content.find("> :first-child")):"image"===K.type?n():"video"===K.type&&q(),i()}function g(a){H.killEvent(a),K&&(K.$lightbox.transition({always:!1,complete:function(){K.$lightbox.off(G.namespace),K.$container.off(G.namespace),I.off(G.namespace),J.off(G.namespace),K.$overlay.remove(),K.$lightbox.remove(),K=null,I.trigger(G.close)}}).addClass(F.animating),J.removeClass(F.open),H.clearTimer(K.resizeTimer))}function h(){{var a=k();K.isMobile?0:K.duration}K.isMobile||K.$controls.css({marginTop:(K.contentHeight-K.controlHeight-K.metaHeight)/2}),!K.visible&&K.isMobile&&K.gallery.active&&K.$content.on(G.touchStart,H.getClassName(F.image),A),(K.isMobile||K.fixed)&&J.addClass(F.open),K.$lightbox.transition({always:!1,property:"height",complete:function(){K.$container.transition({always:!1,complete:function(){K.$lightbox.removeClass(F.animating),K.isAnimating=!1}}),K.$lightbox.removeClass(F.loading),K.visible=!0,I.trigger(G.open),K.gallery.active&&r()}}),K.isMobile||K.$lightbox.css({height:K.contentHeight+K.paddingVertical,width:K.contentWidth+K.paddingHorizontal,top:K.fixed?0:a.top});K.oldContentHeight!==K.contentHeight||K.oldContentWidth!==K.contentWidth;K.oldContentHeight=K.contentHeight,K.oldContentWidth=K.contentWidth}function i(){if(K.visible&&!K.isMobile){var a=k();K.$controls.css({marginTop:(K.contentHeight-K.controlHeight-K.metaHeight)/2}),K.$lightbox.css({height:K.contentHeight+K.paddingVertical,width:K.contentWidth+K.paddingHorizontal,top:K.fixed?0:a.top})}}function j(){var a=k();K.$lightbox.css({top:K.fixed?0:a.top})}function k(){if(K.isMobile)return{left:0,top:0};var a={left:(I.width()-K.contentWidth-K.paddingHorizontal)/2,top:K.top<=0?(I.height()-K.contentHeight-K.paddingVertical)/2:K.top};return K.fixed!==!0&&(a.top+=I.scrollTop()),a}function l(){var a=this.attr("title");return void 0!==a&&""!==a.trim()?'<p class="caption">'+a.trim()+"</p>":""}function m(b){K.$image=a("<img>"),K.$image.one(G.load,function(){var a=D(K.$image);K.naturalHeight=a.naturalHeight,K.naturalWidth=a.naturalWidth,K.retina&&(K.naturalHeight/=2,K.naturalWidth/=2),K.$content.prepend(K.$image),""===K.$caption.html()?K.$caption.hide():K.$caption.show(),n(),h()}).error(z).attr("src",b).addClass(F.image),(K.$image[0].complete||4===K.$image[0].readyState)&&K.$image.trigger(G.load)}function n(){var a=0;for(K.windowHeight=K.viewportHeight=I.height()-K.paddingVertical,K.windowWidth=K.viewportWidth=I.width()-K.paddingHorizontal,K.contentHeight=1/0,K.contentWidth=1/0,K.imageMarginTop=0,K.imageMarginLeft=0;K.contentHeight>K.viewportHeight&&2>a;)K.imageHeight=0===a?K.naturalHeight:K.$image.outerHeight(),K.imageWidth=0===a?K.naturalWidth:K.$image.outerWidth(),K.metaHeight=0===a?0:K.metaHeight,0===a&&(K.ratioHorizontal=K.imageHeight/K.imageWidth,K.ratioVertical=K.imageWidth/K.imageHeight,K.isWide=K.imageWidth>K.imageHeight),K.imageHeight<K.minHeight&&(K.minHeight=K.imageHeight),K.imageWidth<K.minWidth&&(K.minWidth=K.imageWidth),K.isMobile?(K.$meta.css({width:K.windowWidth}),K.metaHeight=K.$meta.outerHeight(!0),K.contentHeight=K.viewportHeight-K.paddingVertical,K.contentWidth=K.viewportWidth-K.paddingHorizontal,o(),K.imageMarginTop=(K.contentHeight-K.targetImageHeight-K.metaHeight)/2,K.imageMarginLeft=(K.contentWidth-K.targetImageWidth)/2):(0===a&&(K.viewportHeight-=K.margin+K.paddingVertical,K.viewportWidth-=K.margin+K.paddingHorizontal),K.viewportHeight-=K.metaHeight,o(),K.contentHeight=K.targetImageHeight,K.contentWidth=K.targetImageWidth),K.$meta.css({width:K.contentWidth}),K.$image.css({height:K.targetImageHeight,width:K.targetImageWidth,marginTop:K.imageMarginTop,marginLeft:K.imageMarginLeft}),K.isMobile||(K.metaHeight=K.$meta.outerHeight(!0),K.contentHeight+=K.metaHeight),a++}function o(){var a=K.isMobile?K.contentHeight-K.metaHeight:K.viewportHeight,b=K.isMobile?K.contentWidth:K.viewportWidth;K.isWide?(K.targetImageWidth=b,K.targetImageHeight=K.targetImageWidth*K.ratioHorizontal,K.targetImageHeight>a&&(K.targetImageHeight=a,K.targetImageWidth=K.targetImageHeight*K.ratioVertical)):(K.targetImageHeight=a,K.targetImageWidth=K.targetImageHeight*K.ratioVertical,K.targetImageWidth>b&&(K.targetImageWidth=b,K.targetImageHeight=K.targetImageWidth*K.ratioHorizontal)),(K.targetImageWidth>K.imageWidth||K.targetImageHeight>K.imageHeight)&&(K.targetImageHeight=K.imageHeight,K.targetImageWidth=K.imageWidth),(K.targetImageWidth<K.minWidth||K.targetImageHeight<K.minHeight)&&(K.targetImageWidth<K.minWidth?(K.targetImageWidth=K.minWidth,K.targetImageHeight=K.targetImageWidth*K.ratioHorizontal):(K.targetImageHeight=K.minHeight,K.targetImageWidth=K.targetImageHeight*K.ratioVertical))}function p(b){K.$videoWrapper=a('<div class="'+F.videoWrapper+'"></div>'),K.$video=a('<iframe class="'+F.video+'" seamless="seamless"></iframe>'),K.$video.attr("src",b).addClass(F.video).prependTo(K.$videoWrapper),K.$content.prepend(K.$videoWrapper),q(),h()}function q(){K.windowHeight=K.viewportHeight=K.contentHeight=I.height()-K.paddingVertical,K.windowWidth=K.viewportWidth=K.contentWidth=I.width()-K.paddingHorizontal,K.videoMarginTop=0,K.videoMarginLeft=0,K.isMobile?(K.$meta.css({width:K.windowWidth}),K.metaHeight=K.$meta.outerHeight(!0),K.viewportHeight-=K.metaHeight,K.targetVideoWidth=K.viewportWidth,K.targetVideoHeight=K.targetVideoWidth*K.videoRatio,K.targetVideoHeight>K.viewportHeight&&(K.targetVideoHeight=K.viewportHeight,K.targetVideoWidth=K.targetVideoHeight/K.videoRatio),K.videoMarginTop=(K.viewportHeight-K.targetVideoHeight)/2,K.videoMarginLeft=(K.viewportWidth-K.targetVideoWidth)/2):(K.viewportHeight=K.windowHeight-K.margin,K.viewportWidth=K.windowWidth-K.margin,K.targetVideoWidth=K.videoWidth>K.viewportWidth?K.viewportWidth:K.videoWidth,K.targetVideoWidth<K.minWidth&&(K.targetVideoWidth=K.minWidth),K.targetVideoHeight=K.targetVideoWidth*K.videoRatio,K.contentHeight=K.targetVideoHeight,K.contentWidth=K.targetVideoWidth),K.$meta.css({width:K.contentWidth}),K.$videoWrapper.css({height:K.targetVideoHeight,width:K.targetVideoWidth,marginTop:K.videoMarginTop,marginLeft:K.videoMarginLeft}),K.isMobile||(K.metaHeight=K.$meta.outerHeight(!0),K.contentHeight=K.targetVideoHeight+K.metaHeight)}function r(){var b="";K.gallery.index>0&&(b=K.gallery.$items.eq(K.gallery.index-1).attr("href"),b.indexOf("youtube.com/embed")<0&&b.indexOf("player.vimeo.com/video")<0&&a('<img src="'+b+'">')),K.gallery.index<K.gallery.total&&(b=K.gallery.$items.eq(K.gallery.index+1).attr("href"),b.indexOf("youtube.com/embed")<0&&b.indexOf("player.vimeo.com/video")<0&&a('<img src="'+b+'">'))}function s(b){H.killEvent(b);var c=a(b.currentTarget);K.isAnimating||c.hasClass(F.control_disabled)||(K.isAnimating=!0,K.gallery.index+=c.hasClass(F.control_next)?1:-1,K.gallery.index>K.gallery.total&&(K.gallery.index=K.gallery.total),K.gallery.index<0&&(K.gallery.index=0),K.$container.transition({always:!1,complete:function(){"undefined"!=typeof K.$image&&K.$image.remove(),"undefined"!=typeof K.$videoWrapper&&K.$videoWrapper.remove(),K.$target=K.gallery.$items.eq(K.gallery.index),K.$caption.html(K.formatter.apply(J,[K.$target])),K.$position.find(H.getClassName(F.position_current)).html(K.gallery.index+1);var a=K.$target.attr("href"),b=a.indexOf("youtube.com/embed")>-1||a.indexOf("player.vimeo.com/video")>-1;b?p(a):m(a),t()}}),K.$lightbox.addClass([F.loading,F.animating].join(" ")))}function t(){K.$controls.removeClass(F.control_disabled),0===K.gallery.index&&K.$controls.filter(H.getClassName(F.control_previous)).addClass(F.control_disabled),K.gallery.index===K.gallery.total&&K.$controls.filter(H.getClassName(F.control_next)).addClass(F.control_disabled)}function u(a){!K.gallery.active||37!==a.keyCode&&39!==a.keyCode?27===a.keyCode&&K.$close.trigger(G.click):(H.killEvent(a),K.$controls.filter(H.getClassName(37===a.keyCode?F.control_previous:F.control_next)).trigger(G.click))}function v(b){var c=a(b).find("> :first-child").clone();x(c)}function w(b){b+=b.indexOf("?")>-1?"&"+K.requestKey+"=true":"?"+K.requestKey+"=true";var c=a('<iframe class="'+F.iframe+'" src="'+b+'"></iframe>');x(c)}function x(a){K.$content.append(a),y(a),h()}function y(a){K.windowHeight=I.height()-K.paddingVertical,K.windowWidth=I.width()-K.paddingHorizontal,K.objectHeight=a.outerHeight(!0),K.objectWidth=a.outerWidth(!0),K.targetHeight=K.targetHeight||K.$target.data(F.namespace+"-height"),K.targetWidth=K.targetWidth||K.$target.data(F.namespace+"-width"),K.maxHeight=K.windowHeight<0?K.minHeight:K.windowHeight,K.isIframe=a.is("iframe"),K.objectMarginTop=0,K.objectMarginLeft=0,K.isMobile||(K.windowHeight-=K.margin,K.windowWidth-=K.margin),K.contentHeight=void 0!==K.targetHeight?K.targetHeight:K.isIframe||K.isMobile?K.windowHeight:K.objectHeight,K.contentWidth=void 0!==K.targetWidth?K.targetWidth:K.isIframe||K.isMobile?K.windowWidth:K.objectWidth,(K.isIframe||K.isObject)&&K.isMobile?(K.contentHeight=K.windowHeight,K.contentWidth=K.windowWidth):K.isObject&&(K.contentHeight=K.contentHeight>K.windowHeight?K.windowHeight:K.contentHeight,K.contentWidth=K.contentWidth>K.windowWidth?K.windowWidth:K.contentWidth)}function z(){var b=a('<div class="'+F.error+'"><p>Error Loading Resource</p></div>');K.type="element",K.$meta.remove(),K.$image.off(G.namespace),x(b)}function A(a){if(H.killEvent(a),H.clearTimer(K.touchTimer),!K.isAnimating){var b="undefined"!=typeof a.originalEvent.targetTouches?a.originalEvent.targetTouches[0]:null;K.xStart=b?b.pageX:a.clientX,K.leftPosition=0,K.touchMax=1/0,K.touchMin=-1/0,K.edge=.25*K.contentWidth,0===K.gallery.index&&(K.touchMax=0),K.gallery.index===K.gallery.total&&(K.touchMin=0),K.$lightbox.on(G.touchMove,B).one(G.touchEnd,C)}}function B(a){var b="undefined"!=typeof a.originalEvent.targetTouches?a.originalEvent.targetTouches[0]:null;K.delta=K.xStart-(b?b.pageX:a.clientX),K.delta>20&&H.killEvent(a),K.canSwipe=!0;var c=-K.delta;c<K.touchMin&&(c=K.touchMin,K.canSwipe=!1),c>K.touchMax&&(c=K.touchMax,K.canSwipe=!1),K.$image.css({transform:"translate3D("+c+"px,0,0)"}),K.touchTimer=H.startTimer(K.touchTimer,300,function(){C(a)})}function C(a){H.killEvent(a),H.clearTimer(K.touchTimer),K.$lightbox.off([G.touchMove,G.touchEnd].join("")),K.delta&&(K.$lightbox.addClass(F.animating),K.swipe=!1,K.canSwipe&&(K.delta>K.edge||K.delta<-K.edge)?(K.swipe=!0,K.$image.css(K.delta<=K.leftPosition?{transform:"translate3D("+K.contentWidth+"px,0,0)"}:{transform:"translate3D("+-K.contentWidth+"px,0,0)"})):K.$image.css({transform:"translate3D(0,0,0)"}),K.swipe&&K.$controls.filter(H.getClassName(K.delta<=K.leftPosition?F.control_previous:F.control_next)).trigger(G.click),H.startTimer(K.resetTimer,K.duration,function(){K.$lightbox.removeClass(F.animating)}))}function D(a){var b=a[0],c=new Image;return"undefined"!=typeof b.naturalHeight?{naturalHeight:b.naturalHeight,naturalWidth:b.naturalWidth}:"img"===b.tagName.toLowerCase()?(c.src=b.src,{naturalHeight:c.height,naturalWidth:c.width}):!1}var E=Formstone.Plugin("lightbox",{widget:!0,defaults:{customClass:"",extensions:["jpg","sjpg","jpeg","png","gif"],fixed:!1,formatter:a.noop,labels:{close:"Close",count:"of",next:"Next",previous:"Previous"},margin:50,minHeight:100,minWidth:100,mobile:!1,retina:!1,requestKey:"boxer",top:0,videoRatio:.5625,videoWidth:600},classes:["overlay","close","loading_icon","container","content","image","video","video_wrapper","meta","control","control_previous","control_next","control_disabled","position","position_current","position_total","caption","caption_gallery","error","loading","animating","fixed","mobile","inline","iframe","open"],events:["open","close"],methods:{_construct:b,_destruct:c,open:h,close:e}}),F=(E.defaults,E.classes),G=E.events,H=E.functions,I=Formstone.$window,J=null,K=null;a(function(){J=Formstone.$body})}(jQuery,window);